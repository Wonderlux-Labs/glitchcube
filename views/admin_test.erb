<!DOCTYPE html>
<html>
<head>
  <title>Glitch Cube Test Interface</title>
  <style>
    body {
      font-family: monospace;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1, h2 { color: #333; }
    form {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      box-sizing: border-box;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover { background: #45a049; }
    .response {
      background: #f9f9f9;
      padding: 15px;
      margin: 20px 0;
      border-left: 4px solid #4CAF50;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .error {
      border-left-color: #f44336;
      background: #ffebee;
    }
    .nav {
      margin-bottom: 20px;
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
    }
    .nav a {
      margin-right: 15px;
      color: #2196F3;
      text-decoration: none;
    }
    .nav a:hover { text-decoration: underline; }
    .message {
      padding: 10px;
      margin: 10px 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .user { border-left: 4px solid #2196F3; }
    .assistant { border-left: 4px solid #4CAF50; }
    .metadata {
      color: #666;
      font-size: 0.9em;
      margin-top: 5px;
    }
  </style>
</head>
<body>

<div class="nav">
  <a href="/admin/test">Test Interface</a>
  <a href="/admin/test/sessions">Sessions</a>
  <a href="/admin/test/memories">Memories</a>
  <a href="/admin/test/tools">Tools</a>
  <a href="/health">System Status</a>
</div>

<h1>Glitch Cube Test Interface</h1>

<!-- Conversation Test Form -->
<form action="/admin/test/conversation" method="POST">
  <h2>Test Conversation</h2>
  
  <label for="message">Message:</label>
  <textarea name="message" id="message" rows="3" required>Hello, how are you today?</textarea>
  
  <label for="persona">Character:</label>
  <select name="persona" id="persona">
    <option value="buddy">Buddy (Helpful Assistant)</option>
    <option value="jax">Jax (Surly Bartender)</option>
    <option value="lomi">Lomi (Drag Queen)</option>
    <option value="zorp">Zorp (Party Bro)</option>
  </select>
  
  <label for="session_id">Session ID (optional):</label>
  <input type="text" name="session_id" id="session_id" placeholder="Leave blank for new session">
  
  <button type="submit">Send Message</button>
</form>

<% if @conversation_response %>
  <div class="response">
    <strong>Response:</strong>
    <%= @conversation_response[:response] %>
    
    <div class="metadata">
      Session: <%= @conversation_response[:session_id] %>
      Persona: <%= @conversation_response[:persona] %>
      Cost: $<%= @conversation_response[:cost] %>
      Continue: <%= @conversation_response[:continue_conversation] %>
    </div>
  </div>
<% end %>

<% if @error %>
  <div class="response error">
    <strong>Error:</strong> <%= @error %>
  </div>
<% end %>

<!-- TTS Test Form -->
<form action="/admin/test/tts" method="POST">
  <h2>Test Text-to-Speech</h2>
  
  <label for="tts_message">Message:</label>
  <input type="text" name="message" id="tts_message" value="Testing text to speech" required>
  
  <label for="tts_character">Character Voice:</label>
  <select name="character" id="tts_character">
    <option value="buddy">Buddy</option>
    <option value="jax">Jax</option>
    <option value="lomi">Lomi</option>
    <option value="zorp">Zorp</option>
  </select>
  
  <button type="submit">Test TTS</button>
</form>

<% if @tts_result %>
  <div class="response">
    TTS Result: <%= @tts_result[:success] ? "✓ Success" : "✗ Failed" %>
    <% if @tts_result[:error] %>
      Error: <%= @tts_result[:error] %>
    <% end %>
  </div>
<% end %>

<!-- Recent Conversations -->
<% if @recent_conversations %>
  <h2>Recent Conversations</h2>
  <% @recent_conversations.each do |conv| %>
    <div class="message">
      <strong><%= conv[:persona] %></strong> - <%= conv[:session_id] %>
      <div class="metadata">
        Messages: <%= conv[:message_count] %> | 
        Cost: $<%= conv[:total_cost] %> |
        Started: <%= conv[:started_at] %>
      </div>
      <a href="/admin/test/sessions/<%= conv[:session_id] %>">View Full Session</a>
    </div>
  <% end %>
<% end %>

</body>
</html>