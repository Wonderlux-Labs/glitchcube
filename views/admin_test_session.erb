<!DOCTYPE html>
<html>
<head>
  <title>Session: <%= @session_id %></title>
  <style>
    body {
      font-family: monospace;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; }
    .nav {
      margin-bottom: 20px;
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
    }
    .nav a {
      margin-right: 15px;
      color: #2196F3;
      text-decoration: none;
    }
    .message {
      padding: 15px;
      margin: 10px 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .user { border-left: 4px solid #2196F3; }
    .assistant { border-left: 4px solid #4CAF50; }
    .tool { border-left: 4px solid #FF9800; }
    .metadata {
      color: #666;
      font-size: 0.9em;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }
    .content {
      white-space: pre-wrap;
      line-height: 1.4;
    }
    .summary {
      background: white;
      padding: 15px;
      margin: 20px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      margin: 20px 0;
      border: 1px solid #ef5350;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<div class="nav">
  <a href="/admin/test">‚Üê Back to Test Interface</a>
  <a href="/admin/test/sessions">All Sessions</a>
</div>

<h1>Session: <%= @session_id %></h1>

<% if @error %>
  <div class="error"><%= @error %></div>
<% else %>
  <div class="summary">
    <strong>Summary</strong><br>
    Messages: <%= @messages.size %><br>
    Total Cost: $<%= @total_cost %><br>
    Total Tokens: <%= @total_tokens %><br>
    Persona: <%= @conversation.persona %>
  </div>

  <% @messages.each do |msg| %>
    <div class="message <%= msg[:role] %>">
      <strong><%= msg[:role].upcase %></strong>
      <% if msg[:persona] %>
        (<%= msg[:persona] %>)
      <% end %>
      - <%= msg[:created_at] %>
      
      <div class="content"><%= msg[:content] %></div>
      
      <% if msg[:cost] || msg[:metadata] %>
        <div class="metadata">
          <% if msg[:cost] %>
            Cost: $<%= msg[:cost] %>
          <% end %>
          <% if msg[:metadata] && msg[:metadata]['tool_calls'] %>
            | Tools: <%= msg[:metadata]['tool_calls'].join(', ') %>
          <% end %>
          <% if msg[:metadata] && msg[:metadata]['continue_conversation'] != nil %>
            | Continue: <%= msg[:metadata]['continue_conversation'] %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
  
  <!-- Continue Conversation Form -->
  <form action="/admin/test/conversation" method="POST" style="margin-top: 30px;">
    <h3>Continue This Conversation</h3>
    <textarea name="message" rows="3" required placeholder="Your message..."></textarea>
    <input type="hidden" name="session_id" value="<%= @session_id %>">
    <input type="hidden" name="persona" value="<%= @conversation.persona %>">
    <button type="submit" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Send Message</button>
  </form>
<% end %>

</body>
</html>